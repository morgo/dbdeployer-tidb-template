#!/bin/bash
{{.Copyright}}
# Generated by dbdeployer {{.AppVersion}} using {{.TemplateName}} on {{.DateTime}}
source {{.SandboxDir}}/sb_include

TIMEOUT=30

mysqld_safe_pid=$(ps auxw | grep mysqld_safe | grep "defaults-file=$SBDIR" | awk '{print $2}')
if [ -n "$(is_running)" ]
then
	MYPID=$(cat $PIDFILE)
	kill -9 $mysqld_safe_pid
	echo "Attempting normal termination --- kill -15 $MYPID"
	kill -15 $MYPID
	# give it a chance to exit peacefully
	ATTEMPTS=1
	while [ -f $PIDFILE ]
	do
ATTEMPTS=$(( $ATTEMPTS + 1 ))
if [ $ATTEMPTS = $TIMEOUT ]
then
	break
fi
sleep $SLEEP_TIME
	done
	if [ -f $PIDFILE ]
	then
echo "SERVER UNRESPONSIVE --- kill -9 $MYPID"
kill -9 $MYPID
rm -f $PIDFILE
	fi
else
	# server not running - removing stale pid-file
	if [ -f $PIDFILE ]
	then
rm -f $PIDFILE
	fi
fi
